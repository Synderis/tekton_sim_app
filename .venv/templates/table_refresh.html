{% extends "base.html" %}
{% block title %}Index{% endblock %}
{% from "bootstrap4/form.html" import render_form %}
{% block head %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<div class="container">
        <img src="{{ image }}" class="high-quality" style="width:80%;"/>
        <form onSubmit="return handleSubmit(event);">
            <input type="number" id="hpInput" name="hpInput" value="{{ hp_default }}" required/>
            <input type="submit" value="Submit" style="margin-top:5px;"/>
            <input type="hidden" id="prev_data" value="{{ json_data }}">
            <div>Input an hp value to compare to the hp values that tekton returns to the anvil with. The default is the average hp value from all the trials.</div>
            <div id="Results"></div>
        </form>
    </div>
    <div class="data-table">
        <table class="result-table" style="width:100%;">
            <caption class="important">Output Snapshot</caption>
            {% for table in data_table %}
            {{ table|safe }}
            {% endfor %}
        </table>
    </div>
<div>
    <button onclick="window.location.href = '{{url_for('gear')}}';" >Return to Gear Selection</button>
</div>
<script>
    function handleSubmit(event) {
    event.preventDefault()
      let table = document.getElementById("Results")
      let number = document.getElementById("hpInput").value;
      let prev_q = document.getElementById("prev_data").value;
      const body = {hpInput: number, query_params: prev_q}

      var options = {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(body),

      };

      fetch("/database", options)
        .then((response) => response.text())
        .then((text) => {
         console.log("data:", text);
        let new_tbl = text
        table.innerHTML = new_tbl;

        })
        .catch((error) => {
          console.error("Error:", error);
        });
      return false;
    }


</script>
<script>
function hrefFunction(){
                windows.location.href = "http://127.0.0.1:5000/gear";
            }
</script>
<style type="text/css">

    .form {
    margin: inline

      /* An explicit background is required here, as it's actually transparent by default, and we
           don't want to see the shadow element behind */
      background: var(--background-color);
    }
        .important { color:  #ff0000; }
         caption {
      display: inline;
      text-align: center;
      font-size: 30px;
    }
    .container {
    width: 90vw;

    display: flex;
    flex-direction: row;
    }
    .container .data-table {
    }
    .container :nth-child(n) {
    padding:5px
    }
</style>

{% endblock %}
